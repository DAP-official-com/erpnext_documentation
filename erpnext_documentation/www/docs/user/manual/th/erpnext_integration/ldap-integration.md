
<!-- add-breadcrumbs -->
# การตั้งค่า LDAP

Lightweight Directory Access Protocol (LDAP) คือระบบควบคุมการเข้าออกแบบรวมศูนย์ที่ใช้โดยองค์กรขนาดเล็กและขนาดกลางจำนวนมาก

ด้วยการตั้งค่าบริการ LDAP คุณสามารถเข้าสู่ระบบบัญชี ERPNext โดยใช้ข้อมูลประจำตัว LDAP

## 1. ข้อกำหนดเบื้องต้น
ในการใช้ LDAP คุณจะต้องติดตั้งโมดูล Python `ldap3' ก่อน ในการดำเนินการนี้ ให้เปิดเซสชันเทอร์มินัลบนเซิร์ฟเวอร์ของคุณที่โฮสต์อินสแตนซ์ ERPNext ไปที่ไดเร็กทอรี `frappe-bench`
รันคำสั่ง: `./env/pip install ldap3`

ตอนนี้คุณพร้อมที่จะเปิดใช้งานบริการ LDAP ใน ERPNext แล้ว

## 2. การตั้งค่า LDAP
ในการตั้งค่า LDAP ให้ไปที่
> หน้าแรก > การรวมระบบ > การตั้งค่า LDAP

จำเป็นต้องมีพารามิเตอร์จำนวนมากเพื่อให้ ERPNext สามารถเชื่อมต่อกับ LDAP ได้ พวกเขาเป็น:

  * URL เซิร์ฟเวอร์ LDAP: นี่คือ URL ไปยังเซิร์ฟเวอร์ LDAP ของคุณ ต้องอยู่ในรูปแบบ `ldap://yourserver:port' หรือ `ldaps://yourserver:port'

  * Base Distinguished Name (DN): นี่คือชื่อเฉพาะของผู้ใช้ที่มีสิทธิ์ค้นหารายละเอียดผู้ใช้บนเซิร์ฟเวอร์ LDAP ของคุณ นี่ควรเป็นผู้ใช้ที่มีสิทธิ์อ่านอย่างเดียวบนเซิร์ฟเวอร์ LDAP ของคุณเท่านั้น

  * รหัสผ่านสำหรับ Base DN: นี่คือรหัสผ่านสำหรับผู้ใช้ด้านบน ซึ่งใช้ในการค้นหารายละเอียดผู้ใช้บนเซิร์ฟเวอร์ LDAP ของคุณ

  * หน่วยองค์กรของผู้ใช้: นี่คือ DN ของหน่วยองค์กรที่ผู้ใช้ทั้งหมดในเซิร์ฟเวอร์ LDAP ของคุณต้องเป็นส่วนหนึ่งจึงจะสามารถเข้าสู่ระบบ ERPNext ได้

  * บทบาทเริ่มต้นในการสร้าง: เมื่อผู้ใช้ถูกสร้างขึ้นใน ERPNext พวกเขาจะได้รับมอบหมายด้วยบทบาทเริ่มต้นนี้ในครั้งแรกที่พวกเขาเข้าสู่ระบบ

  * สตริงการค้นหา LDAP: ช่องนี้อนุญาตให้ ERPNext จับคู่ผู้ใช้/อีเมลที่ป้อนในหน้าจอการเข้าสู่ระบบ ERPNext กับเซิร์ฟเวอร์ LDAP ตัวอย่างเช่น คุณสามารถใช้ที่อยู่อีเมลหรือชื่อผู้ใช้ขึ้นอยู่กับความต้องการของคุณ

    ต้องป้อนในรูปแบบ: `LDAPFIELD={0}`

    ตัวอย่างชื่อผู้ใช้ Active Directory: `sAMAccountName={0}`

    เปิดตัวอย่างชื่อผู้ใช้ LDAP: `uid={0}`

  * ฟิลด์อีเมล LDAP: ระบุฟิลด์ LDAP ที่มีที่อยู่อีเมลของผู้ใช้

    ตัวอย่าง Active Directory และ Open LDAP: `mail`

  * ฟิลด์ชื่อผู้ใช้ LDAP: ระบุฟิลด์ LDAP ที่มีชื่อผู้ใช้ของผู้ใช้

    ตัวอย่าง Active Directory : `sAMAccountName`

    เปิดตัวอย่าง LDAP: `uid`

  * LDAP First Name Field: ระบุฟิลด์ LDAP ที่มีชื่อผู้ใช้

    ตัวอย่าง Active Directory: `givenName`

    เปิดตัวอย่าง LDAP: `sn`

มีฟิลด์ที่ไม่บังคับอื่นๆ มากมายที่คุณสามารถใช้เพื่อแมปฟิลด์ผู้ใช้ LDAP ของคุณกับฟิลด์ผู้ใช้ ERPNext พวกเขาเป็น:

  * ชื่อกลาง
  * โทรศัพท์
  * มือถือ

<img class="screenshot" alt="LDAP Settings" src="{{docs_base_url}}/assets/img/setup/integrations/ldap_settings.png">

เมื่อการตั้งค่าของคุณถูกต้องแล้ว คุณสามารถคลิกช่องทำเครื่องหมาย "เปิดใช้งาน" ที่ด้านบนได้ เมื่อพยายามเปิดใช้งาน LDAP ERPNext จะพยายามเชื่อมต่อกับเซิร์ฟเวอร์ LDAP เพื่อให้แน่ใจว่าการตั้งค่าถูกต้อง หากล้มเหลว คุณจะไม่สามารถเปิดใช้งาน LDAP และจะได้รับข้อความแสดงข้อผิดพลาด

ข้อความแสดงข้อผิดพลาดจะระบุถึงปัญหาที่ต้องแก้ไขเพื่อดำเนินการต่อ

หลังจากตั้งค่าเปิดใช้งาน LDAP บนหน้าจอเข้าสู่ระบบ ระบบจะเปิดใช้งานตัวเลือก **เข้าสู่ระบบผ่าน LDAP**

<img class="screenshot" alt="LOGIN via LDAP" src="{{docs_base_url}}/assets/img/setup/integrations/login_via_ldap.png">

### 2.1 ความปลอดภัย LDAP

ในส่วนความปลอดภัย LDAP คุณมีตัวเลือกมากมายในการเชื่อมต่ออย่างปลอดภัยกับเซิร์ฟเวอร์ LDAP ของคุณ

  * ####### โหมด SSL/TLS
    ระบุว่าคุณต้องการเริ่มเซสชัน TLS ในการเชื่อมต่อเริ่มต้นกับเซิร์ฟเวอร์ LDAP หรือไม่

  * ####### ต้องการใบรับรองที่เชื่อถือได้
    ระบุว่าคุณต้องการใบรับรองที่เชื่อถือได้เพื่อเชื่อมต่อกับเซิร์ฟเวอร์ LDAP


  หากคุณกำลังระบุใบรับรองที่เชื่อถือได้ คุณจะต้องระบุเส้นทางไปยังไฟล์ใบรับรองของคุณ ไฟล์เหล่านี้จะต้องวางบนเซิร์ฟเวอร์ ERPNext ของคุณ และฟิลด์ต่อไปนี้ควรเป็นพาธสัมบูรณ์ไปยังไฟล์บนเซิร์ฟเวอร์ของคุณ
    ฟิลด์ใบรับรองคือ:

  * เส้นทางไปยังไฟล์คีย์ส่วนตัว

  * เส้นทางสู่ใบรับรองเซิร์ฟเวอร์

  * เส้นทางไปยังไฟล์ใบรับรอง CA


### 2.2 การแมปกลุ่ม LDAP
ERPNext ยังอนุญาตให้คุณแมปกลุ่ม LDAP หลายกลุ่มกับบทบาท ERPNext ที่เหมาะสมโดยอัตโนมัติ
ตัวอย่างเช่น คุณอาจต้องการให้พนักงานบัญชีทั้งหมดของคุณมีบทบาทผู้ใช้บัญชีโดยอัตโนมัติ

ตรวจสอบให้แน่ใจว่าคุณกรอกฟิลด์กลุ่ม LDAP เพื่ออนุญาต นี่คือฟิลด์ LDAP ที่พบในอ็อบเจ็กต์ผู้ใช้ใน LDAP ซึ่งมีกลุ่มทั้งหมดที่ผู้ใช้เป็นสมาชิกอยู่

สำหรับ Active Directory และ Open LDAP ควรตั้งค่าช่องนี้เป็น "memberOf"

การเปิด LDAP อาจจำเป็นต้องเปิดใช้ช่องนี้บนเซิร์ฟเวอร์ LDAP ของคุณ โปรดดูตัวอย่างบนอินเทอร์เน็ตสำหรับรายละเอียดเพิ่มเติม

> โปรดทราบว่าบทบาท ERPNext ทั้งหมดจะถูกตรวจสอบทุกครั้งที่ผู้ใช้เข้าสู่ระบบ และจะถูกลบออกหรือเพิ่มในการอนุญาตของผู้ใช้

<img class="screenshot" alt="LDAP Group Mappings" src="{{docs_base_url}}/assets/img/setup/integrations/ldap_group_mappings.png">

ในพื้นที่การตั้งค่า LDAP มีสองดรอปดาวน์
1. โหมด SSL/TLS - ตั้งค่านี้เป็น **StartTLS** เพื่อเชื่อมต่อกับเซิร์ฟเวอร์ LDAP ของคุณโดยใช้ StartTLS หากเซิร์ฟเวอร์ LDAP ของคุณไม่รองรับ StartTLS การตั้งค่านี้เป็น StartTLS จะทำให้เกิดข้อผิดพลาด `ไม่รองรับ StartTLS' ตรวจสอบการกำหนดค่าบนเซิร์ฟเวอร์ LDAP หากคุณได้รับข้อผิดพลาดนี้
2. ต้องการใบรับรองที่เชื่อถือได้ - หากคุณเปลี่ยนเป็น **ใช่** ใบรับรองที่เซิร์ฟเวอร์ LDAP ให้มาจะต้องได้รับความเชื่อถือจากเซิร์ฟเวอร์ Frappe/ERPNext หากคุณต้องการใช้ StartTLS กับใบรับรองที่ลงนามเอง (ไม่น่าเชื่อถือ) ให้ตั้งค่าเป็น **ไม่** หากคุณไม่ได้ใช้ StartTLS การตั้งค่านี้จะถูกละเว้น
